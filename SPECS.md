# 簡易出納帳の仕様

udemy教材にてclienの勉強、gemini-2.0-flash-thinking-exp-1219のAPIにて実装検証

## 構成
- 技術スタック
- 画面項目仕様
- テーブル設計書

## 技術スタック
### バックエンド
- 言語：TypeScript / Node.js
- フレームワーク：fastify
- ORM：Prisma
- DB：PostgreSQL

## テーブル設計

| 物理名     | 論理名       | 型       | 桁数 | NOT NULL | デフォルト値 | primary key | auto increment | 備考                        |
| ---------- | ------------ | -------- | ---: | :------: | :----------: | :---------: | :------------: | --------------------------- |
| id         | ID           | int      |      |    1     |              |      1      |       1        |                             |
| date       | 日付         | date     |      |    1     |              |             |                |                             |
| item       | 項目         | string   |  255 |    1     |              |             |                |                             |
| amount     | 金額         | int      |      |    1     |      0       |             |                |                             |
| type       | 種別         | smallint |    4 |    1     |              |             |                | 1:収入, 2: 支出             |
| created_at | 作成日時     | datetime |      |    1     |              |             |                | insert時の日時を登録        |
| updated_at | 最終更新日時 | datetime |      |    1     |              |             |                | insert/update時の日時を登録 |

## 画面項目

### 新しい取引を追加

出納帳の入力フォームです
「追加」ボタンを押下すると、エンドポイント`/register`に値をPOSTします

| 論理名 | 物理名 |     型     | 桁数 | NOT NULL | デフォルト値 | 備考                     |
| ------ | ------ | :--------: | :--: | :------: | :----------- | ------------------------ |
| 日付   | date   | yyyy/mm/dd |      |    1     |              | datepickerライブラリ使用 |
| 項目   | item   |   string   | 255  |    1     |              |                          |
| 金額   | amount |    int     |      |    1     | 0            |                          |
| 種別   | type   |   select   |      |    1     |              | 1:収入, 2: 支出          |
| 追加   |        |   button   |      |    1     |              | ボタン                   |

### 取引一覧

入力されたデータの一覧です
エンドポイント:`/transactions`で取得した値を表示します
primary keyの降順で表示します

| 論理名 | 物理名 |  type  | 備考                                                                     |
| ------ | ------ | :----: | ------------------------------------------------------------------------ |
| 日付   | date   |  date  | yyyy/mm/dd形式で表示                                                     |
| 項目   | item   | string |                                                                          |
| 金額   | amount |  int   | カンマ区切りで表示<br>収入だったら`color:green`, 支出だったら`color:red` |
| 種別   | type   | string | 1=収入, 2=支出で、数値ではなく日本語名で表示                             |

### 合計

取引の合計金額を表示します
エンドポイント:`/transactions`で取得した値を計算して、総収入、総支出、取引残高を出します

| 論理名   | 物理名               | type | 備考                                                                                         |
| -------- | -------------------- | :--: | -------------------------------------------------------------------------------------------- |
| 総収入   | total_revenue        | int  | type=1:収入の金額`amount`の合計。<br>カンマ区切りで表示 `{total_revenue}`円                  |
| 総支出   | total_expenses       | int  | type=2:支出の金額`amount`の合計。<br>カンマ区切りで表示 `{total_revenue}`円                  |
| 取引残高 | transaction_balances | int  | = 総収入`total_revenue` - 総支出`total_expenses`。<br>カンマ区切りで表示 `{total_revenue}`円 |

### グラフ

取引のデータをグラフで表示します
表示単位のセレクトボックスにて日単位・月単位・年単位を選択すると、それぞれ日単位・月単位・年単位でグラフを描画します
グラフは折れ線グラフで、横軸は日付で左が古く、右が新しい日付、横軸は金額です
エンドポイント:`/transactions`で取得した値でグラフを描画します

| 論理名   | 物理名       |   型   | 備考                                               |
| -------- | ------------ | :----: | -------------------------------------------------- |
| 表示単位 | display_unit | select | daily：日単位<br>monthly：月単位<br>yearly：年単位 |

## エンドポイント

### 取引一覧
- リクエスト: `GET`
- URL: `/transactions`
- 成功レスポンス:  `200 OK`
  ```json
  [
    {
      "id"         : "1",
      "date"       : "2025-10-01",
      "item"       : "給料",
      "amount"     : "400000",
      "type"       : "1",
      "created_at" : "2025-10-01 07:00:00",
      "updated_at" : "2025-10-01 07:00:00",
    },
    {
      "id"         : "2",
      "date"       : "2025-10-27",
      "item"       : "家賃",
      "amount"     : "120000",
      "type"       : "2",
      "created_at" : "2025-10-27 09:00:00",
      "updated_at" : "2025-10-27 09:00:00",
    }
  ]
  ```

### 新しい取引を追加
- リクエスト: `POST`
- URL: `/register`
- リクエストボディ: 
  ```json
  {
    "date"       : "2025-11-25",
    "item"       : "給料",
    "amount"     : 400000,
    "type"       : 1
  }
  ```
- 成功レスポンス: `201 Created`
  ```json
  {
    "id"         : 3,
    "date"       : "2025-11-25",
    "item"       : "給料",
    "amount"     : 400000,
    "type"       : 1,
    "created_at" : "2025-11-25 07:00:00",
    "updated_at" : "2025-11-25 07:00:00",
  }
  ```
- 失敗レスポンス: `400 Bad Request`
  ```json
  {
    "errors": [
      {"field": "date", "message": "日付は必須です。"},
      {"field": "item", "message": "項目は必須です。"}
    ]
  }
  ```
