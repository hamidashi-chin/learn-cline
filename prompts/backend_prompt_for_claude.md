# Cline用プロンプト戦略 - 簡易出納帳バックエンド構築

## 🎯 基本戦略

### 1. 段階的アプローチ
- **一度に全てを求めない**：プロジェクト初期化 → DB設計 → API実装 → テスト の順で進める
- **動作確認を重視**：各段階で動作テストを含める
- **具体的な指示**：「〜を作って」ではなく「〜を作成し、〜で動作確認して」

### 2. 情報の整理と提供
- **仕様書を分割**：一度に全仕様を渡さず、必要な部分を段階的に提供
- **既存フロントエンドとの連携**：フロントエンドの期待するレスポンス形式を明示

## 📝 推奨プロンプトの流れ

### Phase 1: プロジェクト初期化
```
TypeScript + Node.js + Fastify + Prisma + SQLiteで簡易出納帳のバックエンドAPIを作成します。

以下の技術スタックで新しいプロジェクトを初期化してください：
- TypeScript
- Node.js
- Fastify (Web フレームワーク)
- Prisma (ORM)
- SQLite (データベース)

プロジェクト名: simple-accounting-backend

必要な依存関係をインストールし、基本的なプロジェクト構造を作成してください。
作成後、npm run devでサーバーが起動することを確認してください。
```

### Phase 2: データベース設計
```
Prismaを使用してデータベーススキーマを作成します。

テーブル名: Transaction
以下のフィールドを持つテーブルを作成してください：

| フィールド名 | 型        | 制約                    | 備考 |
|-------------|-----------|------------------------|------|
| id          | Int       | @id @default(autoincrement()) | 主キー |
| date        | DateTime  | 必須                    | 取引日 |
| item        | String    | 必須, 最大255文字        | 項目名 |
| amount      | Int       | 必須, デフォルト0        | 金額 |
| type        | Int       | 必須                    | 1:収入, 2:支出 |
| createdAt   | DateTime  | @default(now())         | 作成日時 |
| updatedAt   | DateTime  | @updatedAt              | 更新日時 |

スキーマ作成後、マイグレーションを実行してデータベースを作成してください。
動作確認として、Prisma Studioでテーブルが作成されていることを確認してください。
```

### Phase 3: API実装 (取引一覧)
```
Fastifyを使用して取引一覧を取得するAPIエンドポイントを作成してください。

仕様：
- URL: GET /transactions
- レスポンス: 全ての取引データを作成日時の降順で返す
- レスポンス形式:
```json
[
  {
    "id": 1,
    "date": "2025-10-01",
    "item": "給料", 
    "amount": 400000,
    "type": 1,
    "created_at": "2025-10-01T07:00:00.000Z",
    "updated_at": "2025-10-01T07:00:00.000Z"
  }
]
```

実装後、curl またはPostmanでAPIが正常に動作することを確認してください。
エラーハンドリングも含めて実装してください。
```

### Phase 4: API実装 (取引登録)
```
取引を新規登録するAPIエンドポイントを作成してください。

仕様：
- URL: POST /register
- リクエストボディ:
```json
{
  "date": "2025/11/25",
  "item": "給料",
  "amount": 400000,
  "type": 1
}
```

バリデーション：
- date: 日付形式チェック (yyyy/mm/dd)
- item: 必須、255文字以内
- amount: 数値、正の整数
- type: 1(収入)または2(支出)のみ

成功時: 201 Created + 作成されたデータ
失敗時: 400 Bad Request + エラー詳細

実装後、正常系・異常系の両方でテストしてください。
```

### Phase 5: CORS設定とフロントエンド連携
```
フロントエンドからのAPIアクセスを可能にするため、CORS設定を追加してください。

また、既存のHTMLフロントエンドからAPIを呼び出すようにJavaScriptを修正してください。
現在のサンプルデータ部分を削除し、APIからデータを取得するように変更してください。

変更箇所：
1. entries配列の初期化をAPI呼び出しに変更
2. addEntry関数でPOST /registerを呼び出し
3. renderEntries関数でGET /transactionsを呼び出し

動作確認として、フロントエンドからの新規登録・一覧表示が正常に動作することを確認してください。
```

### Phase 6: エラーハンドリング強化
```
エラーハンドリングを強化してください。

要件：
1. 500系エラーの統一メッセージ対応
2. バリデーションエラーの詳細メッセージ
3. ログ出力機能の追加
4. データベース接続エラーの処理

フロントエンド側でも適切なエラー表示ができるように調整してください。
```

## 💡 プロンプト作成のコツ

### ✅ 良いプロンプト
- **具体的な技術スタック**を明示
- **期待する結果**を詳細に記述
- **動作確認方法**を含める
- **一つの段階**に集中

### ❌ 避けるべきプロンプト
- 「簡易出納帳のバックエンドを全部作って」
- 技術スタックが曖昧
- 仕様書をそのまま丸投げ
- 動作確認の指示がない

## 🔧 トラブルシューティング用プロンプト

### エラーが発生した場合
```
以下のエラーが発生しています：
[エラーメッセージを貼り付け]

このエラーの原因を分析し、修正してください。
修正後、動作確認を行って正常に動くことを確認してください。
```

### コードレビュー依頼
```
作成されたコードをレビューして、以下の観点で改善提案をしてください：
1. セキュリティ
2. パフォーマンス  
3. コードの可読性
4. エラーハンドリング
5. TypeScriptの型安全性

改善案があれば具体的な修正コードも提示してください。
```

## 📊 進捗管理

### チェックリスト
- [ ] プロジェクト初期化完了
- [ ] Prismaスキーマ作成・マイグレーション完了
- [ ] GET /transactions 実装・テスト完了
- [ ] POST /register 実装・テスト完了  
- [ ] CORS設定・フロントエンド連携完了
- [ ] エラーハンドリング強化完了
- [ ] 統合テスト完了

この段階的なアプローチで、確実に動作するシステムを構築できます！