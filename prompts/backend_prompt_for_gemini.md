あなたは経験豊富なフルスタックエンジニアです。
提供された仕様書に基づいて、簡易出納帳アプリケーションを実装してください。

**主な期待する成果物:**
1.  **バックエンド**: Node.js/TypeScript, Fastify, Prisma, SQLite を使用したAPIサーバー。
    * Prismaスキーマファイル (`schema.prisma`)。
    * 各エンドポイントの実装。
    * 仕様書に基づいたバリデーションロジック。
2.  **フロントエンド**:
    * **技術スタック**: ReactとMUIを使用してください。
    * 仕様書に記載された各画面機能（新しい取引の追加、取引一覧、合計、グラフ）。
    * `flatpickr` ライブラリを使用した日付入力。
    * Chart.js を使用したグラフ描画（以前提示したHTMLに含まれていた`<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>`を参考に）。
3.  **データベース**:
    * Prismaによるマイグレーションファイルの生成手順に関するコメントや指示（AIが直接実行はできませんが、開発者が行うべき手順として）。

**実装に関する詳細指示:**

**全般:**
* 可読性が高く、メンテナンスしやすいコードを生成してください。
* 主要なロジックや複雑な箇所には、理解を助けるためのコメントを適切に追加してください。
* エラーハンドリングは堅牢に行ってください。

**バックエンド詳細:**
* Prismaスキーマ: 仕様書の「テーブル設計」および「エンドポイント」セクションの「Prismaスキーマで `created_at` には `@default(now())` を、`updated_at` には `@updatedAt` を設定します」という指示を確実に反映してください。
* バリデーション: 仕様書の「バリデーション」セクションに基づき、Fastifyのルート定義またはPrismaの機能を利用して、各エンドポイントで適切な入力値バリデーションを実装してください。特に、型チェック、必須チェック、数値範囲チェックなどを考慮してください。

**フロントエンド詳細:**
* **HTML構造**: 
    * 本プロジェクトのルートディレクトリにあるindex.htmlを利用、もしくは参考にしてviewを構築してください。

* **エラーハンドリング**:
    * **クライアントサイドバリデーションエラー**: 「新しい取引を追加」フォームでは、API送信前に入力値をチェックし、問題があれば各入力フィールドの下（例：`<span class="error-message" id="date-error"></span>`のような要素）に具体的なエラーメッセージを表示してください。
    * **APIエラー**:
        * `POST /register` で400エラー（仕様書記載の形式）が返ってきた場合、レスポンスの`errors`配列を元に、対応するフィールドの下にエラーメッセージを表示してください。
        * ネットワークエラー（オフラインなど）が発生した場合は、「通信エラーが発生しました。ネットワーク接続を確認してください。」といったメッセージをフォーム上部などに表示してください。
        * 500系エラーの場合は、仕様書通り「サーバーで問題が発生しました。しばらくしてからもう一度お試しください。」というメッセージを表示してください。
    * APIリクエスト中は、「追加」ボタンを無効化し、「処理中...」のようなローディング表示を行ってください。
* **取引一覧**:
    * 仕様書通り、金額の色分け（収入:緑、支出:赤）と、種別の日本語名表示（1:収入、2:支出）をJavaScriptで実装してください。
    * 金額はカンマ区切りで表示してください。
* **合計表示**:
    * 仕様書では「エンドポイント:`/transactions`で取得した値を計算して」とありますが、**フロントエンドで全取引データを取得して計算する想定で実装してください。**（もしデータ量が多い場合の懸念があれば、パフォーマンスを考慮してバックエンドに集計APIを設けることも検討可能ですが、まずはフロントエンドでの計算で進めてください。）
    * 総収入、総支出、取引残高をカンマ区切りで表示してください。
* **グラフ表示**:
    * 仕様書通り、`transactions` APIから取得したデータをもとに、Chart.jsを使用して日単位・月単位・年単位の折れ線グラフを描画してください。**データ集計ロジック（日別、月別、年別の収支集計）はフロントエンドのJavaScriptで実装してください。**
    * 表示単位のセレクトボックスの変更に連動してグラフが再描画されるようにしてください。
* **`flatpickr` の利用**: 日付入力フィールド(`id="date"`)に `flatpickr` を適用し、カレンダーからの日付選択を可能にしてください。
* **（任意）ダークモード**: 以前提示したHTMLに含まれていたダークモード機能も、もし可能であれば実装に含めてください。ボタンクリックでライトモードとダークモードが切り替わるようにしてください。

**実装の進め方（推奨）:**
1.  まず、PrismaスキーマとバックエンドAPI（`/transactions` および `/register`）の基本的なCRUD機能とバリデーションを実装してください。
2.  次に、フロントエンドの「新しい取引を追加」機能と「取引一覧」表示機能（API連携を含む）を実装してください。
3.  その後、「合計」表示機能と「グラフ」表示機能を実装してください。
4.  最後に、全体的なエラーハンドリングの強化やUIの微調整を行ってください。

---
**仕様書:**
# 簡易出納帳の仕様

## 構成
- 技術スタック
- 画面項目仕様
- テーブル設計書

## 技術スタック
### バックエンド
- 言語：TypeScript / Node.js
- フレームワーク：fastify
- ORM：Prisma
- DB：sqlite

## テーブル設計

| 物理名     | 論理名       | 型       | 桁数 | NOT NULL | デフォルト値 | primary key | auto increment | 備考                        |
| ---------- | ------------ | -------- | ---: | :------: | :----------: | :---------: | :------------: | --------------------------- |
| id         | ID           | int      |      |    1     |              |      1      |       1        |                             |
| date       | 日付         | date     |      |    1     |              |             |                |                             |
| item       | 項目         | string   |  255 |    1     |              |             |                |                             |
| amount     | 金額         | int      |      |    1     |      0       |             |                |                             |
| type       | 種別         | smallint |    4 |    1     |              |             |                | 1:収入, 2: 支出             |
| created_at | 作成日時     | datetime |      |    1     |              |             |                | insert時の日時を登録        |
| updated_at | 最終更新日時 | datetime |      |    1     |              |             |                | insert/update時の日時を登録 |

## 画面項目

### 新しい取引を追加

出納帳の入力フォームです
「追加」ボタンを押下すると、エンドポイント`/register`に値をPOSTします

| 論理名 | 物理名 |     型     | 桁数 | NOT NULL | デフォルト値 | 備考                      |
| ------ | ------ | :--------: | :--: | :------: | :----------- | ------------------------- |
| 日付   | date   | yyyy/mm/dd |      |    1     |              | `flatpickr`ライブラリ使用 |
| 項目   | item   |   string   | 255  |    1     |              |                           |
| 金額   | amount |    int     |      |    1     | 0            |                           |
| 種別   | type   |   select   |      |    1     |              | 1:収入, 2: 支出           |
| 追加   |        |   button   |      |    1     |              | ボタン                    |

### 取引一覧

入力されたデータの一覧です
エンドポイント:`/transactions`で取得した値を表示します
primary keyの降順で表示します

| 論理名 | 物理名 |  type  | 備考                                                                     |
| ------ | ------ | :----: | ------------------------------------------------------------------------ |
| 日付   | date   |  date  | yyyy/mm/dd形式で表示                                                     |
| 項目   | item   | string |                                                                          |
| 金額   | amount |  int   | カンマ区切りで表示<br>収入だったら`color:green`, 支出だったら`color:red` |
| 種別   | type   | string | 1=収入, 2=支出で、数値ではなく日本語名で表示                             |

### 合計

取引の合計金額を表示します
エンドポイント:`/transactions`で取得した値を計算して、総収入、総支出、取引残高を出します

| 論理名   | 物理名               | type | 備考                                                                                         |
| -------- | -------------------- | :--: | -------------------------------------------------------------------------------------------- |
| 総収入   | total_revenue        | int  | type=1:収入の金額`amount`の合計。<br>カンマ区切りで表示 `{total_revenue}`円                  |
| 総支出   | total_expenses       | int  | type=2:支出の金額`amount`の合計。<br>カンマ区切りで表示 `{total_revenue}`円                  |
| 取引残高 | transaction_balances | int  | = 総収入`total_revenue` - 総支出`total_expenses`。<br>カンマ区切りで表示 `{total_revenue}`円 |

### グラフ

取引のデータをグラフで表示します
表示単位のセレクトボックスにて日単位・月単位・年単位を選択すると、それぞれ日単位・月単位・年単位でグラフを描画します
グラフは折れ線グラフで、横軸は日付で左が古く、右が新しい日付、横軸は金額です
エンドポイント:`/transactions`で取得した値でグラフを描画します

| 論理名   | 物理名       |   型   | 備考                                               |
| -------- | ------------ | :----: | -------------------------------------------------- |
| 表示単位 | display_unit | select | daily：日単位<br>monthly：月単位<br>yearly：年単位 |

## バリデーション

| 論理名 | 物理名 |     型     | 桁数 | NOT NULL | 備考                                                                                          |
| ------ | ------ | :--------: | :--: | :------: | --------------------------------------------------------------------------------------------- |
| 日付   | date   | yyyy/mm/dd |      |    1     | yyyy/mm/ddの日付型以外はエラー                                                                |
| 項目   | item   |   string   | 255  |    1     |                                                                                               |
| 金額   | amount |    int     |      |    1     | 数値以外が渡ってきた場合はエラー<br>またintの最大・最小値の範囲外の値が入力された場合もエラー |
| 種別   | type   |   select   |      |    1     | 1:収入、2: 支出、それ以外の値が渡ってきた時はエラー                                           |

## エンドポイント

### 取引一覧
- リクエスト: `GET`
- URL: `/transactions`
- 成功レスポンス:  `200 OK`
  ```json
  [
    {
      "id"         : "1",
      "date"       : "2025-10-01",
      "item"       : "給料",
      "amount"     : "400000",
      "type"       : "1",
      "created_at" : "2025-10-01 07:00:00",
      "updated_at" : "2025-10-01 07:00:00",
    },
    {
      "id"         : "2",
      "date"       : "2025-10-27",
      "item"       : "家賃",
      "amount"     : "120000",
      "type"       : "2",
      "created_at" : "2025-10-27 09:00:00",
      "updated_at" : "2025-10-27 09:00:00",
    }
  ]
  ```
- Prismaスキーマで `created_at` には `@default(now())` を、`updated_at` には `@updatedAt` を設定します

### 新しい取引を追加
- リクエスト: `POST`
- URL: `/register`
- リクエストボディ: 
  ```json
  {
    "date"       : "2025/11/25",
    "item"       : "給料",
    "amount"     : 400000,
    "type"       : 1
  }
  ```
- 成功レスポンス: `201 Created`
  ```json
  {
    "id"         : 3,
    "date"       : "2025-11-25",
    "item"       : "給料",
    "amount"     : 400000,
    "type"       : 1,
    "created_at" : "2025-11-25 07:00:00",
    "updated_at" : "2025-11-25 07:00:00",
  }
  ```
- 失敗レスポンス: `400 Bad Request`
  ```json
  {
    "errors": [
      {"field": "date", "message": "日付は必須です。"},
      {"field": "item", "message": "項目は必須です。"}
    ]
  }
  ```

### 全エンドポイント共通事項

HTTPステータスコードが500系の場合は、下記メッセージ表示するようにします
```
サーバーで問題が発生しました。しばらくしてからもう一度お試しください。
```
---
